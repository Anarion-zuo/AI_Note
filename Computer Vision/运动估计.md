# 运动估计
## 背景建模
### 相对运动的基本方式
1. 相机静止，目标运动——背景提取/减除
2. 相机运动，目标静止——光流估计(全局运动)
3. 相机和目标均运动——光流估计
### 背景建模原理
#### 帧差法：后一帧图像减去前一帧图像即减掉了不动的背景。
$$
D(x,y)=\begin{cases}
1 & I(x,y,t)-I(x,y,t-1)>T\\
0 & others
\end{cases}
$$
$D(x,y)$：帧差$\quad I(x,y,t)$：当前帧图像$\quad I(x,y,t-1)$：上一帧图像$\quad T$：像素灰度阈值

缺点：
1. 前后帧重合导致空洞
2. 噪声被放大
#### 改进：高斯背景
像素在一段时间内灰度服从正态分布，大多灰度值落在3倍标准差的范围内。根据$3\sigma$原则，若像素灰度落在3倍标准差范围外，则认为该像素属于前景，否则属于背景。然而，并不是所有背景像素的灰度变化都严格服从正态分布，故引入混合高斯模型。
##### 混合高斯模型：调整权重
任何一种分布函数都可以看作多个高斯分布函数的线性组合。在一个时间段内，发现图像的二维分布密度聚集在多个位置，即认为该背景服从混合高斯模型，并具有多个分量。
$$
p(x) = \sum_{q=1}^Q p(x|w_q)P(w_q)\\
p(I) = \sum_{q=1}^{Q}w_q N(I;\mu _q, \sigma _q ^2)
$$
##### 步骤
- 模型初始化：将采集到的第一帧图像的每个像素的灰度值作为均值，再赋以较大的方差。初始$Q=1,w=1.0$，一个分量。$Q$为最大分量数。
- 模型学习：将当前帧的对应像素的灰度值与已有的$Q$个高斯模型作比较，若满足 $\exists k,q, |x_k-\mu _{q,k}|<2.5\sigma _{q,k}$，则按上文方式调整第$q$个高斯模型的参数和权重，若不满足，则转入下一步。
- 增加/替换高斯分量：若不满足上步条件，且$q<Q$，则增加一个新分量，若$q=Q$，则替换权重最小的分量。
- 判断：
$$
B = \arg\min_{b} (\sum_{q=1}^{b}w_q > T),T \approx 0.6 - 0.9
$$
##### 计算
$$
w_q(k+1) = (1-\alpha)w_q(k) + \alpha M_q(k+1)\\
\mu_q(k+1) = (1-\rho)\mu_q(k) + \rho I(k+1)\\
\sigma_q^2(k+1) = (1-\rho)\sigma_q^2(k) + \rho (I(k+1)-\mu_q(k+1))^2\\
\rho = \alpha G(I(k+1);\mu_q,\sigma_q)
$$